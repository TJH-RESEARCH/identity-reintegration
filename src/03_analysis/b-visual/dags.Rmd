---
title: "Directed Acyclical Graphs: Military Identity and Post-Service Readjustment - The Role of Help Seeking Attitudes and Regimentation"
output: html_document
date: "2024-01-14"
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(dagitty)
library(ggdag)

```




Directed acyclical graphs (DAGs) encode hypotheses about the relationship between variables into graphs. DAGs can be analyzed to determine the appropriate variables to include in a model in order to isolate the effect of interest from the effects of other variables. 

My approach is to build several different DAGs, each of which represents a different general model. I will also build some DAGs that are appendages to or variables of the overall model.

The point is to fit several plausible models, perhaps with different implications, or with some more parsimonious while others more detailed. 

## Bivariate

I am interested in the relationship between military identity and reintegration difficulty.

This could be modeled as a normally distributed outcome that is a function of a linear input:

$$ y_i \sim Normal(\mu_i, \sigma) \\ \mu_i = \alpha + \beta x_i $$

```{r}

dag_bivariate <- 
  
  dagify('RD' ~ 'Mil_ID',
         exposure = 'Mil_ID', 
         outcome = 'RD')


ggdag::tidy_dagitty(dag_bivariate)
```


Add coordinates.

``` {r}
coordinates(dag_bivariate) <- list(
  x = c(Mil_ID = 0, RD = 1),
  y = c(Mil_ID = 1, RD = 1)
)
```

Now plot the model.

``` {r}
ggdag(dag_bivariate)
```


## Mediation Model

Now I will incorporate attitudes toward help seeking. In this case, I would expect "inconsistent mediation."

$$ y_i \sim Normal(\mu_i, \sigma) \\ \mu_i = \alpha + \beta_1 x_i + \beta_2 m_i \\ 
m_i \sim Normal(\mu_i, \sigma) \\ \mu_{i} = \alpha + \beta_1 x_i $$


```{r}

dag_mediation <- 
  
  dagify('RD' ~ 'Mil_ID' + 'HS',
         'HS' ~ 'Mil_ID',
         exposure = 'Mil_ID', 
         outcome = 'RD')

coordinates(dag_mediation) <- list(
  x = c(Mil_ID = 0, RD = 1, HS = .5),
  y = c(Mil_ID = 1, RD = 1, HS = 1.1)
)
ggdag::tidy_dagitty(dag_mediation)
ggdag(dag_mediation) +
  geom_dag_point(colour = 'white') +
  geom_dag_edges() +
  geom_dag_text(color = 'black', size = 6) +
  theme_dag()
```

## Moderation Model

When I first told my colleague about my "inconsistent mediation" thesis, he suggested what I really meant was moderation, not mediation. 

The assumption would be that strength of military identity is not associated with attitudes toward seeking help. From, X:

> "A potential moderating variable, $Mo_i$, which is either some stable individual difference variable, assumed not to be affected by the treatment, or else some measure of the context or situation under which the treatment is delivered. We presume it is measured prior to the delivery of the treatment, and therefore, given random assignment to $X_i$, it is assumed that $Mo_i$ and $X_i$ are independent of each other (Muller et al, 2005, p. 853)."

Is help seeking a moderator? An individual condition that is not associated with military identity, but that would affect the strength of the associated between military identity and reintegration difficulty?

Or is it just a variable that should be controlled for. That is, are military identity and help seeking not associated at all?

Theoretically, I do not think this makes sense. 

$$ y_i \sim Normal(\mu_i, \sigma) \\ \mu_i = \alpha + \beta_1 x_i + \beta_2 m_i + \beta_3 x_i m_i $$

```{r}

dag_moderation <- 
  
  dagify('RD' ~ 'Mil_ID' + 'HS' + 'HSxMil_ID',
         exposure = 'Mil_ID', 
         outcome = 'RD')

coordinates(dag_moderation) <- list(
  x = c(Mil_ID = 0, RD = 1, HS = .25, HSxMil_ID = .5),
  y = c(Mil_ID = 1, RD = 1, HS = 1.125, HSxMil_ID = 1.25)
)
ggdag::tidy_dagitty(dag_moderation)
ggdag(dag_moderation) +   
  geom_dag_point(colour = 'white') +
  geom_dag_edges() +
  geom_dag_text(color = 'black', size = 6) +
  theme_dag()

  
```

## Dual Mediation


```{r}

dag_mediation_dual <- 
   
  dagify('RD' ~ 'Mil_ID' + 'HS' + 'Reg',
         'HS' ~ 'Mil_ID',
         'Reg' ~ 'Mil_ID',
         exposure = 'Mil_ID', 
         outcome = 'RD')

coordinates(dag_mediation_dual) <- list(
  x = c(Mil_ID = 0, RD = 1, HS = .5, Reg = .5),
  y = c(Mil_ID = 1, RD = 1, HS = 1.1, Reg =1.2)
)
ggdag::tidy_dagitty(dag_mediation_dual)
ggdag(dag_mediation_dual) +
  geom_dag_point(colour = 'white') +
  geom_dag_edges() +
  geom_dag_text(color = 'black', size = 6) +
  theme_dag()
```





## Dual Mediation


```{r}

dag_antecedents <- 
   
  dagify('RD' ~ 'Race' + 'Sex' + 'Era' + 'Officer' + 'Age',
         'Mil_ID' ~ 'Race' + 'Sex' + 'Era' + 'Officer' + 'Age',
         exposure = 'Mil_ID', 
         outcome = 'RD')


coordinates(dag_antecedents) <- list(
  x = c(Mil_ID = 0, RD = 1, HS =  .5, Reg = .5, Race = .75, Sex = .25, Era = .3, Officer = .7, Age = .5),
  y = c(Mil_ID = 1, RD = 1, HS = 1.1, Reg = 1.2, Race = .87, Sex = .87, Era = .91, Officer =.91, Age = .95)
)

ggdag::tidy_dagitty(dag_antecedents)
ggdag(dag_antecedents) +
  geom_dag_point(colour = 'white') +
  geom_dag_edges() +
  geom_dag_text(color = 'black', size = 6) +
  theme_dag()
```

### Adjustment Sets
``` {r}
ggdag_adjustment_set(dag_1_basic) +
ggplot2::labs(caption = 'Mil_ID = Military Identity; RD = Reintegration Difficulties; HS = Attitude toward help seeking')


```



`